<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Bday Khari Jii</title>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --rpg-blue: #0000aa;
            --rpg-border: #ffffff;
            --btn-gold: #ffcc00;
        }

        /* High-Quality Loading Overlay */
        #loading-screen {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle, #1a1a1a, #000);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            z-index: 3000;
            font-family: 'Press Start 2P', cursive;
        }
        .loader-bar { width: 350px; height: 35px; border: 6px double #fff; background: #111; margin-top: 25px; padding: 2px; }
        #p-bar { width: 0%; height: 100%; background: linear-gradient(90deg, #00aa00, #00ff00); transition: 0.2s; }

        body {
            /* High Quality Intro Background: Space/Dungeon Hybrid */
            background-color: #050505;
            background-image: 
                radial-gradient(circle at 50% 50%, rgba(50, 0, 50, 0.4), transparent),
                linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px);
            background-size: 100% 100%, 40px 40px, 40px 40px;
            color: white;
            font-family: 'Press Start 2P', cursive;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            min-height: 100vh; margin: 0; overflow: hidden;
            transition: 1s ease;
        }

        /* High Quality Game Stage Background */
        body.mode-active {
            background-color: #2e1a0e;
            background-image: 
                linear-gradient(rgba(0,0,0,0.3) 2px, transparent 2px),
                linear-gradient(90deg, rgba(0,0,0,0.3) 2px, transparent 2px),
                linear-gradient(45deg, #3d2b1f 25%, transparent 25%),
                linear-gradient(-45deg, #3d2b1f 25%, transparent 25%);
            background-size: 60px 60px, 60px 60px, 30px 30px, 30px 30px;
        }

        .main-title {
            color: var(--btn-gold);
            text-shadow: 4px 4px #000;
            font-size: 22px;
            margin-bottom: 25px;
            z-index: 100;
        }

        /* 3:2 Video Container */
        .game-container {
            position: relative;
            width: 900px; height: 600px;
            border: 10px solid #8b5a2b;
            border-style: ridge;
            background: url('background.jpg') no-repeat center center;
            background-size: cover;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 100px rgba(0,0,0,0.9);
            z-index: 50; overflow: hidden;
        }

        video { position: absolute; width: 100%; height: 100%; object-fit: contain; background: #000; display: none; z-index: 60; }

        /* Secret Message Box */
        #secret-box {
            position: fixed; bottom: 40px; width: 85%; max-width: 750px;
            background: var(--rpg-blue); border: 6px double var(--rpg-border);
            padding: 30px; display: none; z-index: 2500; font-size: 14px;
            cursor: pointer; box-shadow: 0 0 40px rgba(0,0,0,1);
            animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* UI Controls */
        .controls { margin-top: 30px; display: none; gap: 12px; z-index: 100; flex-wrap: wrap; justify-content: center; }
        .game-btn { 
            font-family: 'Press Start 2P', cursive; padding: 14px 20px; cursor: pointer; 
            border: 4px solid #fff; background: #000; color: #fff; font-size: 10px;
            transition: 0.1s;
        }
        .game-btn:hover { background: #fff; color: #000; transform: translateY(-3px); }
        .game-btn:active { transform: translateY(0); }

        #start-btn { z-index: 70; padding: 25px 50px; font-size: 30px; background: #cc0000; color: white; border: 8px ridge #660000; cursor: pointer; }

        .balloon { position: absolute; width: 70px; height: 90px; border-radius: 50%; cursor: pointer; z-index: 80; animation: float 4s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0) rotate(5deg); } 50% { transform: translateY(-30px) rotate(-5deg); } }
    </style>
</head>
<body>

    <div id="loading-screen">
        <p>LOADING LEVEL 1...</p>
        <div class="loader-bar"><div id="p-bar"></div></div>
    </div>

    <div class="main-title">HAPPY BDAY KHARI JII</div>

    <div class="game-container" id="screen">
        <video id="video-element" preload="auto" playsinline>
            <source id="video-source" src="celebration.mp4" type="video/mp4">
        </video>
        <button id="start-btn" onclick="initGame()">â–¶ START</button>
    </div>

    <div class="controls" id="ui-controls">
        <button class="game-btn" style="color: #00ff00; border-color: #00ff00;" onclick="togglePause()">PAUSE/PLAY</button>
        <button class="game-btn" onclick="restartVideo()">RESTART</button>
        <button class="game-btn" style="color: #00ffff; border-color: #00ffff;" onclick="toggleFullScreen()">FULLSCREEN</button>
        <button class="game-btn" onclick="playMode('celebration.mp4')">CELEBRATION</button>
        <button class="game-btn" onclick="playMode('moments.mp4')">MOMENTS</button>
    </div>

    <div id="secret-box">
        I hope you liked it. Best Wishes for today. You will do great in your life. Always keep smiling.....
        <br><br><span style="font-size: 10px; color: #00ffff;">[CLICK TO CLOSE]</span>
    </div>

    <audio id="pop-sound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3" preload="auto"></audio>

    <script>
        const video = document.getElementById('video-element');
        const source = document.getElementById('video-source');
        const pBar = document.getElementById('p-bar');
        const loadingScreen = document.getElementById('loading-screen');
        const secretBox = document.getElementById('secret-box');
        
        let poppedCount = 0;
        let totalBalloons = 12;

        // Optimized Loader
        video.addEventListener('progress', () => {
            if (video.duration > 0 && video.buffered.length > 0) {
                const percent = (video.buffered.end(0) / video.duration) * 100;
                pBar.style.width = percent + "%";
            }
        });

        video.oncanplaythrough = () => {
            pBar.style.width = "100%";
            setTimeout(() => { loadingScreen.style.display = 'none'; }, 800);
        };

        function initGame() {
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('ui-controls').style.display = 'flex';
            document.body.classList.add('mode-active');
            video.style.display = 'block';
            video.play();
            spawnBalloons(totalBalloons);
        }

        function playMode(file) {
            source.src = file;
            video.load();
            video.play();
        }

        function togglePause() { video.paused ? video.play() : video.pause(); }
        function restartVideo() { video.currentTime = 0; video.play(); }

        function toggleFullScreen() {
            const sc = document.getElementById('screen');
            if (!document.fullscreenElement) sc.requestFullscreen().catch(err => alert(err.message));
            else document.exitFullscreen();
        }

        // Fixed Secret Box Logic
        function spawnBalloons(num) {
            const colors = ['#ff69b4', '#00ff00', '#00ffff', '#ffff00', '#ff4500'];
            for (let i = 0; i < num; i++) {
                const b = document.createElement('div');
                b.className = 'balloon';
                b.style.backgroundColor = colors[i % colors.length];
                b.style.left = Math.random() * 85 + '%'; b.style.top = Math.random() * 75 + '%';
                b.onclick = function() { 
                    document.getElementById('pop-sound').play(); 
                    this.remove();
                    poppedCount++;
                    if(poppedCount === totalBalloons) secretBox.style.display = 'block';
                };
                document.getElementById('screen').appendChild(b);
            }
        }

        secretBox.onclick = function() { this.style.display = 'none'; };
    </script>
</body>
</html>
